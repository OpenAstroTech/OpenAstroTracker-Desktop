<Window x:Class="OATControl.DlgChecklist"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
		xmlns:Controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:mah="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
		xmlns:controls="clr-namespace:OATControl.Controls" 
		xmlns:converters="clr-namespace:OATControl.Converters"
		mc:Ignorable="d"
        MinHeight="310" Width="600" MinWidth="204" Height="500" 
        WindowStyle="None" 
        WindowStartupLocation="Manual"
        Activated="Window_Activated"
        Closing="Window_Closing"
		Title="{Binding ListTitle}"
        Loaded="Window_Loaded">	
	<Window.Resources>

		<!-- Style for subitems -->
		<Style x:Key="SubItemStyle" TargetType="TextBlock">
			<Setter Property="FontSize" Value="14" />
			<Setter Property="Margin" Value="20,0,0,0" />
			<Setter Property="Foreground" Value="Black" />
		</Style>

		<converters:DebugConverter x:Key="DebugConverter"/>
		<converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" Collapse="True"/>
		<converters:BoolToStringConverter x:Key="BoolToTextConverter" TrueString="Save" FalseString="Edit"/>
            <!-- Existing resources -->

        <!-- Style for ToolTips -->
        <Style TargetType="ToolTip">
            <Setter Property="Background" Value="#600" />
            <Setter Property="Foreground" Value="#F00" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Padding" Value="10,4" />
            <Setter Property="BorderBrush" Value="#700" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" BlurRadius="5" ShadowDepth="2" />
                </Setter.Value>
            </Setter>
        </Style>
		<converters:BoolToBrushConverter x:Key="HeaderColorConverter" TrueBrush="#842" FalseBrush="#F86" />
		<converters:BoolToBrushConverter x:Key="SubitemColorConverter" TrueBrush="#930" FalseBrush="#F40" />
		<Style x:Key="TextBoxSmall" TargetType="TextBox" BasedOn="{StaticResource MetroTextBox}" >
			<Setter Property="Margin" Value="10,2,10,2" />
			<Setter Property="Height" Value="11" />
			<Setter Property="Background" Value="#770000" />
			<Setter Property="Foreground" Value="#F00" />
			<Setter Property="Width" Value="60" />
			<Setter Property="HorizontalAlignment" Value="Left"/>
		</Style>
		<Style x:Key="TextBlockHeading" TargetType="TextBlock" BasedOn="{StaticResource MetroTextBlock}">
			<Setter Property="VerticalAlignment" Value="Center" />
			<Setter Property="FontWeight" Value="Bold" />
			<Setter Property="FontSize" Value="20" />
			<Setter Property="Margin" Value="2,0" />
			<Setter Property="Padding" Value="6,0" />
			<Setter Property="HorizontalAlignment" Value="Left" />
			<Setter Property="Foreground" Value="#B00" />
		</Style>
		<Style x:Key="TextBlockLabel" TargetType="TextBlock" BasedOn="{StaticResource TextBlockHeading}">
			<Setter Property="FontSize" Value="13" />
			<Setter Property="Margin" Value="0,8,0,0" />
			<Setter Property="Padding" Value="2,0" />
			<Setter Property="HorizontalAlignment" Value="Left" />
		</Style>
		<Style x:Key="TextBlockOptionHelp" TargetType="TextBlock" BasedOn="{StaticResource MetroTextBlock}">
			<Setter Property="FontSize" Value="8" />
			<Setter Property="FontWeight" Value="Normal" />
			<Setter Property="TextWrapping" Value="Wrap" />
			<Setter Property="Width" Value="190" />
			<Setter Property="Margin" Value="2,0,0,0" />
			<Setter Property="Foreground" Value="#B00" />
		</Style>

		<Style x:Key="TextBlockOptionHelpNoWidth" TargetType="TextBlock" BasedOn="{StaticResource MetroTextBlock}">
			<Setter Property="FontSize" Value="8" />
			<Setter Property="FontWeight" Value="Normal" />
			<Setter Property="TextWrapping" Value="Wrap" />
			<Setter Property="Margin" Value="2,0,0,0" />
			<Setter Property="Foreground" Value="#B00" />
		</Style>
		<Style x:Key="TextBlockDescription" TargetType="TextBlock" BasedOn="{StaticResource TextBlockLabel}">
			<Setter Property="FontSize" Value="10" />
			<Setter Property="FontWeight" Value="Normal" />
			<Setter Property="Margin" Value="0,0,0,0" />
			<Setter Property="Padding" Value="2,0" />
			<Setter Property="HorizontalAlignment" Value="Left" />
			<Setter Property="VerticalAlignment" Value="Top" />
		</Style>
		<Style x:Key="EditImageSquareButtonStyle" TargetType="Button" BasedOn="{StaticResource AccentedSquareButtonStyle}">
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border BorderBrush="#401111" BorderThickness="2" x:Name="ImageBorder" Height="20" Padding="1" Background="#800000">
							<Viewbox>
								<Grid>
									<Grid Name="backgroundGrid" Width="128" Height="128" Visibility="Visible">
										<Rectangle Fill="#FF800000" Visibility="Visible" x:Name="backgroundRect"/>
									</Grid>
									<Path Data="M20.638062,9.6380005L6.6380615,23.638 8.3620605,25.362 22.362061,11.362z M20.5,4.5L27.5,11.5 9,30 0,32 2,23z M27,0C29.760986,0 32,2.2389832 32,5 32,6.1259766 31.628052,7.1640015 31,8L29,10 22,3 24,1C24.83606,0.37197876,25.874023,0,27,0z" 
										  x:Name="colorGear"
										  Stretch="Uniform" 
										  Fill="#E00" 
										  Width="116" 
										  Height="116" 
										  Margin="0,0,0,0" 
										  RenderTransformOrigin="0.5,0.5">
										<Path.RenderTransform>
											<TransformGroup>
												<TransformGroup.Children>
													<RotateTransform Angle="0" />
													<ScaleTransform ScaleX="1" ScaleY="1" />
												</TransformGroup.Children>
											</TransformGroup>
										</Path.RenderTransform>
									</Path>
								</Grid>
							</Viewbox>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="ImageBorder" Property="BorderBrush" Value="#200" />
								<Setter TargetName="backgroundRect" Property="Fill" Value="#600000" />
								<Setter TargetName="colorGear" Property="Fill" Value="#C00" />
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
		<Style x:Key="CloseImageSquareButtonStyle" TargetType="Button" BasedOn="{StaticResource AccentedSquareButtonStyle}">
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border BorderBrush="#401111" BorderThickness="2" x:Name="ImageBorder" Height="20" Padding="1" Background="#800000">
							<Viewbox>
								<Grid>
									<Grid Name="backgroundGrid" Width="128" Height="128" Visibility="Visible">
										<Rectangle Fill="#FF800000" Visibility="Visible" x:Name="backgroundRect"/>
									</Grid>
									<Path Data="M2.999979,0C3.8000264,0,4.4999763,0.30000305,5.1000115,0.90000927L15.999954,11.700012 26.899959,0.90000927C28.099967,-0.29998779 29.999927,-0.29998779 31.099961,0.90000927 32.299972,2.1000061 32.299972,4 31.099961,5.1000061L20.199958,16 31.099961,26.900009C32.299972,28.100006 32.299972,30 31.099961,31.100006 29.899951,32.300003 27.999931,32.300003 26.899959,31.100006L15.999954,20.200012 5.1000115,31.100006C3.9000017,32.300003 1.9999809,32.300003 0.90000743,31.100006 -0.30000248,29.900009 -0.30000248,28 0.90000743,26.900009L11.800011,16 0.90000743,5.1000061C-0.30000248,3.9000092 -0.30000248,2 0.90000743,0.90000927 1.4999818,0.30000305 2.1999928,0 2.999979,0z"
										  x:Name="colorGear"
										  Stretch="Uniform" 
										  Fill="#E00" 
										  Width="116" 
										  Height="116" 
										  Margin="0,0,0,0" 
										  RenderTransformOrigin="0.5,0.5">
										<Path.RenderTransform>
											<TransformGroup>
												<TransformGroup.Children>
													<RotateTransform Angle="0" />
													<ScaleTransform ScaleX="1" ScaleY="1" />
												</TransformGroup.Children>
											</TransformGroup>
										</Path.RenderTransform>
									</Path>
								</Grid>
							</Viewbox>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="ImageBorder" Property="BorderBrush" Value="#200" />
								<Setter TargetName="backgroundRect" Property="Fill" Value="#600000" />
								<Setter TargetName="colorGear" Property="Fill" Value="#C00" />
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
			<!--<Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#700" />
                    <Setter Property="BorderBrush" Value="#600" />
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#400" />
                    <Setter Property="BorderBrush" Value="#500" />
                </Trigger>
            </Style.Triggers>-->
		</Style>
		<Style x:Key="ResetImageSquareButtonStyle" TargetType="Button" BasedOn="{StaticResource AccentedSquareButtonStyle}">
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border BorderBrush="#401111" BorderThickness="2" x:Name="ImageBorder" Height="20" Padding="1" Background="#800000">
							<Viewbox>
								<Grid>
									<Grid Name="backgroundGrid" Width="128" Height="128" Visibility="Visible">
										<Rectangle Fill="#FF800000" Visibility="Visible" x:Name="backgroundRect"/>
									</Grid>
									<Path Data="M18.426025,0C25.913025,-4.8468792E-08 32,6.1669937 32,13.741 32,21.319005 25.913025,27.485999 18.426025,27.485999 15.667999,27.485999 13.104004,26.643989 10.960022,25.207007L13.22702,21.690984C14.718018,22.694005 16.506012,23.284001 18.426025,23.284001 23.620026,23.284001 27.848022,19.002996 27.848022,13.741 27.848022,8.4829731 23.620026,4.2029734 18.426025,4.2029734 14.284027,4.2029734 10.796021,6.9379898 9.5350037,10.711001L14.376007,10.767978 7.053009,22.125981 0,10.591983 5.2090149,10.653995C6.5980225,4.5649729,11.991028,-4.8468792E-08,18.426025,0z" 
										  x:Name="colorGear"
										  Stretch="Uniform" 
										  Fill="#E00" 
										  Width="116" 
										  Height="116" 
										  Margin="0,0,0,0" 
										  RenderTransformOrigin="0.5,0.5">
										<Path.RenderTransform>
											<TransformGroup>
												<TransformGroup.Children>
													<RotateTransform Angle="0" />
													<ScaleTransform ScaleX="1" ScaleY="1" />
												</TransformGroup.Children>
											</TransformGroup>
										</Path.RenderTransform>
									</Path>
								</Grid>
							</Viewbox>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsMouseOver" Value="True">
								<Setter TargetName="ImageBorder" Property="BorderBrush" Value="#200" />
								<Setter TargetName="backgroundRect" Property="Fill" Value="#600000" />
								<Setter TargetName="colorGear" Property="Fill" Value="#C00" />
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
			<!--<Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#700" />
                    <Setter Property="BorderBrush" Value="#600" />
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#400" />
                    <Setter Property="BorderBrush" Value="#500" />
                </Trigger>
            </Style.Triggers>-->
		</Style>
	</Window.Resources>
	<Grid Margin="0">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>
		<DockPanel Grid.Row="0" HorizontalAlignment="Stretch">
			<Grid HorizontalAlignment="Stretch">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="Auto" />
					<ColumnDefinition Width="Auto" />
					<ColumnDefinition Width="Auto" />
				</Grid.ColumnDefinitions>
				<TextBlock Grid.Column="0" Text="{Binding ListTitle}" Foreground="#C44" FontSize="16" FontWeight="Bold" Margin="0,0,0,0" HorizontalAlignment="Center" VerticalAlignment="Center" MouseDown="OnTitleMouseDown" MouseMove="OnTitleMouseMove" MouseUp="OnTitleMouseUp" Cursor="SizeAll"/>
				<Button Grid.Column="1" HorizontalAlignment="Right" Width="20" Height="20" Margin="2,2,1,0" Click="OnResetClick"  Padding="0"  Style="{StaticResource ResetImageSquareButtonStyle}" ToolTip="Uncheck all items in this checklist" Cursor="Arrow"/>
				<Button Grid.Column="2" HorizontalAlignment="Right" Width="20" Height="20" Margin="2,2,1,0" Command="{Binding EditChecklistCommand}" Padding="0"  Style="{StaticResource EditImageSquareButtonStyle}" ToolTip="Edit this checklist" Cursor="Arrow"/>
				<Button Grid.Column="3" HorizontalAlignment="Right" Width="20" Height="20" Margin="2,2,5,0" Click="OnCloseClick" Padding="0"  Style="{StaticResource CloseImageSquareButtonStyle}" ToolTip="Close this checklist" Cursor="Arrow"/>
			</Grid>
		</DockPanel>
		<Grid Grid.Row="1" Margin="5,2,5,5">
			<Grid.RowDefinitions>
				<RowDefinition Height="*" />
				<RowDefinition Height="Auto" />
			</Grid.RowDefinitions>
			<!-- Main Checklist view -->
			<Border Grid.Row="0" BorderThickness="1" BorderBrush="#FF880000" Margin="0,0,0,0" >
				<Grid>
					<ItemsControl ItemsSource="{Binding ChecklistItems}">
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<!-- Header Item (First Level) -->
								<StackPanel>
									<!-- Header with checkbox -->
									<StackPanel Orientation="Horizontal" Margin="5,15,0,0">
										<CheckBox IsChecked="{Binding IsChecked, Mode=TwoWay}">
											<CheckBox.Style>
												<Style TargetType="CheckBox">
													<Setter Property="Background" Value="#600" />
													<Setter Property="BorderThickness" Value="1" />
													<Setter Property="BorderBrush" Value="#B55" />
													<Setter Property="VerticalAlignment" Value="Center"/>
													<Setter Property="Padding" Value="0,2,0,0"/>
													<Setter Property="Template">
														<Setter.Value>
															<ControlTemplate TargetType="CheckBox">
																<BulletDecorator Background="Transparent">
																	<BulletDecorator.Bullet>
																		<Border x:Name="Border" 
																			Width="16" 
																			Height="16" 
																			CornerRadius="2" 
																			Background="{TemplateBinding Background}"
																			BorderBrush="{TemplateBinding BorderBrush}"
																			BorderThickness="{TemplateBinding BorderThickness}">
																			<Path x:Name="CheckMark"
																				Width="10" 
																				Height="10" 
																				Stroke="{TemplateBinding Foreground}" 
																				StrokeThickness="2"
																				Data="M 0,4 L 3,8 L 8,0" 
																				Visibility="Collapsed"
																				SnapsToDevicePixels="True"/>
																		</Border>
																	</BulletDecorator.Bullet>
																	<ContentPresenter Margin="{TemplateBinding Padding}"
																	  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
																	  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
																	  RecognizesAccessKey="True"/>
																</BulletDecorator>
																<ControlTemplate.Triggers>
																	<Trigger Property="IsChecked" Value="True">
																		<Setter TargetName="CheckMark" Property="Visibility" Value="Visible"/>
																	</Trigger>
																	<Trigger Property="IsMouseOver" Value="True">
																		<Setter TargetName="Border" Property="Background" Value="#822"/>
																	</Trigger>
																	<MultiTrigger>
																		<MultiTrigger.Conditions>
																			<Condition Property="IsChecked" Value="True"/>
																			<Condition Property="IsMouseOver" Value="True"/>
																		</MultiTrigger.Conditions>
																		<Setter TargetName="Border" Property="Background" Value="#B54"/>
																	</MultiTrigger>
																</ControlTemplate.Triggers>
															</ControlTemplate>
														</Setter.Value>
													</Setter>
													<Style.Triggers>
														<DataTrigger Binding="{Binding IsChecked}" Value="True">
															<Setter Property="Background" Value="#A43" />
															<Setter Property="Foreground" Value="#F88" />
														</DataTrigger>
													</Style.Triggers>
												</Style>
											</CheckBox.Style>
										</CheckBox>
										<TextBlock Text="{Binding Text}" 
											FontWeight="Bold"
											FontSize="16"
											Padding="5,0"
											HorizontalAlignment="Left"
											Foreground="{Binding IsChecked, Converter={StaticResource HeaderColorConverter}}"
											Margin="0,0,0,2"
											VerticalAlignment="Center">
										</TextBlock>
									</StackPanel>

									<!-- Sub-items (Second Level) - always expanded -->
									<ItemsControl ItemsSource="{Binding SubItems}" Margin="26,0,0,0">
										<ItemsControl.ItemTemplate>
											<DataTemplate>
												<StackPanel Orientation="Horizontal" Margin="0,0,0,0">
													<!-- Sub-item without checkbox -->
													<CheckBox IsChecked="{Binding IsChecked, Mode=TwoWay}">
														<CheckBox.Style>
															<Style TargetType="CheckBox">
																<Setter Property="Background" Value="#600" />
																<Setter Property="BorderThickness" Value="1" />
																<Setter Property="BorderBrush" Value="#B55" />
																<Setter Property="VerticalAlignment" Value="Center"/>
																<Setter Property="Padding" Value="0,2,0,2"/>
																<Setter Property="Template">
																	<Setter.Value>
																		<ControlTemplate TargetType="CheckBox">
																			<BulletDecorator Background="Transparent">
																				<BulletDecorator.Bullet>
																					<Border x:Name="Border" 
																			Width="12" 
																			Height="12" 
																			CornerRadius="0" 
																			Background="{TemplateBinding Background}"
																			BorderBrush="{TemplateBinding BorderBrush}"
																			BorderThickness="{TemplateBinding BorderThickness}">
																						<Path x:Name="CheckMark"
																				Width="10" 
																				Height="10" 
																				Stroke="{TemplateBinding Foreground}" 
																				StrokeThickness="1"
																				Data="M 0,4 L 3,8 L 8,0" 
																				Visibility="Collapsed"
																				SnapsToDevicePixels="True"/>
																					</Border>
																				</BulletDecorator.Bullet>
																				<ContentPresenter Margin="{TemplateBinding Padding}"
																	  HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
																	  VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
																	  RecognizesAccessKey="True"/>
																			</BulletDecorator>
																			<ControlTemplate.Triggers>
																				<Trigger Property="IsChecked" Value="True">
																					<Setter TargetName="CheckMark" Property="Visibility" Value="Visible"/>
																				</Trigger>
																				<Trigger Property="IsMouseOver" Value="True">
																					<Setter TargetName="Border" Property="Background" Value="#822"/>
																				</Trigger>
																				<MultiTrigger>
																					<MultiTrigger.Conditions>
																						<Condition Property="IsChecked" Value="True"/>
																						<Condition Property="IsMouseOver" Value="True"/>
																					</MultiTrigger.Conditions>
																					<Setter TargetName="Border" Property="Background" Value="#B54"/>
																				</MultiTrigger>
																			</ControlTemplate.Triggers>
																		</ControlTemplate>
																	</Setter.Value>
																</Setter>
																<Style.Triggers>
																	<DataTrigger Binding="{Binding IsChecked}" Value="True">
																		<Setter Property="Background" Value="#A43" />
																		<Setter Property="Foreground" Value="#F88" />
																	</DataTrigger>
																</Style.Triggers>
															</Style>
														</CheckBox.Style>
													</CheckBox>
													<TextBlock Text="{Binding Text, StringFormat=' {0}' }" 
														Foreground="{Binding IsChecked, Converter={StaticResource SubitemColorConverter}}"
														FontSize="13"
															   Margin="0,0,0,2">
													</TextBlock>
												</StackPanel>
											</DataTemplate>
										</ItemsControl.ItemTemplate>
									</ItemsControl>
								</StackPanel>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</Grid>
			</Border>
		</Grid>
	</Grid>
</Window>
	
	